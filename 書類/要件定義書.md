# PRM Tool 要件定義書

**プロジェクト名:** PRM Tool（Partner Relationship Management Tool）  
**バージョン:** 1.0  
**作成日:** 2026年2月10日  
**最終更新日:** 2026年2月10日

---

## 📚 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [目的と背景](#目的と背景)
3. [ステークホルダー](#ステークホルダー)
4. [システム概要](#システム概要)
5. [機能要件](#機能要件)
6. [非機能要件](#非機能要件)
7. [システムアーキテクチャ](#システムアーキテクチャ)
8. [データモデル](#データモデル)
9. [セキュリティ要件](#セキュリティ要件)
10. [制約事項](#制約事項)
11. [開発スケジュール](#開発スケジュール)
12. [リスクと対策](#リスクと対策)

---

## プロジェクト概要

### プロジェクト名
PRM Tool（Partner Relationship Management Tool）

### プロジェクトの目的
パートナー企業との関係管理、プロジェクト管理、手数料管理、請求書管理、コンテンツ管理を統合的に行うWebアプリケーションを開発する。

### 対象範囲
- パートナー企業の情報管理
- プロジェクトの作成・編集・管理
- 手数料ルールの作成・確定
- 請求書の作成・PDF出力
- コンテンツ（ファイル・フォルダー）の管理と共有
- ユーザーアカウントの管理

---

## 目的と背景

### ビジネス上の課題

#### 現状の問題点
1. **情報の分散化**
   - パートナー企業の情報がExcelや紙ベースで管理されている
   - プロジェクト情報が複数のツールに分散
   - 手数料計算が手動で行われ、ミスが発生

2. **非効率な業務フロー**
   - 請求書作成に多くの手作業が必要
   - パートナーとのファイル共有が煩雑
   - 権限管理が不十分で情報漏洩のリスク

3. **スケーラビリティの欠如**
   - パートナー数の増加に対応できない
   - プロジェクト数の増加で管理が困難

### 期待される効果

1. **業務効率化**
   - 情報の一元管理で検索・閲覧時間を50%削減
   - 手数料の自動計算でミスを99%削減
   - 請求書作成時間を70%削減

2. **コスト削減**
   - 手作業の削減で人件費を30%削減
   - ペーパーレス化で印刷・郵送コストを90%削減

3. **セキュリティ向上**
   - ロールベースアクセス制御で情報漏洩リスクを最小化
   - 監査ログで不正アクセスを検知

---

## ステークホルダー

### プロジェクトオーナー
- **役割:** プロジェクトの最終意思決定者
- **責任:** 予算承認、要件の最終承認

### プロジェクトマネージャー
- **役割:** プロジェクトの進行管理
- **責任:** スケジュール管理、リスク管理

### エンドユーザー
1. **システム管理者（SYSTEM）**
   - アカウント管理
   - システム初期設定

2. **管理者（ADMIN）**
   - 全機能へのアクセス
   - データの作成・編集・削除

3. **会計担当（ACCOUNTING）**
   - 手数料ルールの管理
   - 請求書の作成・管理

4. **営業担当（REP）**
   - プロジェクトの閲覧・編集
   - コンテンツの管理

---

## システム概要

### システムの目的
パートナー企業との関係を効率的に管理し、プロジェクト、手数料、請求書、コンテンツを統合的に管理するWebアプリケーション。

### システムの特徴
1. **一元管理**
   - パートナー、プロジェクト、手数料、請求書、コンテンツを1つのシステムで管理

2. **自動化**
   - 手数料の自動計算
   - 請求書の自動生成
   - 郵便番号からの住所自動入力

3. **権限管理**
   - ロールベースアクセス制御（RBAC）
   - 4段階の権限レベル

4. **使いやすさ**
   - 直感的なUI/UX
   - レスポンシブデザイン

---

## 機能要件

### FR-001: 認証・認可

#### FR-001-01: ログイン機能
- **優先度:** 高
- **説明:** ユーザーがログインIDとパスワードでログインできる
- **入力:**
  - ログインID（必須）
  - パスワード（必須）
- **処理:**
  - 認証情報をバックエンドに送信
  - JWTトークンを発行
  - ローカルストレージにトークンを保存
- **出力:**
  - 認証成功 → ダッシュボードへリダイレクト
  - 認証失敗 → エラーメッセージ表示
- **検証:**
  - ログインIDが存在すること
  - パスワードが一致すること

#### FR-001-02: ロールベースアクセス制御
- **優先度:** 高
- **説明:** ユーザーロールに応じて機能へのアクセスを制限
- **ロール:**
  - SYSTEM: アカウント管理のみ
  - ADMIN: 全機能へのアクセス
  - ACCOUNTING: 手数料・請求書管理
  - REP: プロジェクトの閲覧・編集
- **検証:**
  - 各ロールで許可された機能のみアクセス可能

---

### FR-002: アカウント管理

#### FR-002-01: ユーザー作成
- **優先度:** 高
- **対象ロール:** SYSTEM、ADMIN
- **説明:** 新規ユーザーを作成できる
- **入力:**
  - ユーザー名（必須）
  - ログインID（必須、一意）
  - パスワード（必須、8文字以上）
  - メールアドレス（必須、Email形式）
  - 電話番号（任意）
  - 住所（任意）
  - 役職（任意）
  - ロール（必須）
- **処理:**
  - パスワードをハッシュ化
  - データベースに保存
- **検証:**
  - ログインIDが一意であること
  - パスワードが8文字以上であること

#### FR-002-02: ユーザー編集
- **優先度:** 中
- **対象ロール:** SYSTEM、ADMIN
- **説明:** 既存ユーザーの情報を編集できる
- **制約:**
  - パスワードは編集可能
  - ログインIDは変更不可

#### FR-002-03: ユーザー削除
- **優先度:** 中
- **対象ロール:** SYSTEM、ADMIN
- **説明:** 既存ユーザーを削除できる
- **制約:**
  - システム保護フラグがtrueのユーザーは削除不可

---

### FR-003: パートナー管理

#### FR-003-01: パートナー作成
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** 新規パートナー企業を登録できる
- **入力:**
  - 企業名（必須、一意）
  - 業界（任意）
  - 電話番号（任意、形式: 03-1234-5678）
  - 郵便番号（任意、7桁の数字）
  - 住所（任意）
  - メールアドレス（任意、Email形式）
  - 担当者情報（複数可）
- **処理:**
  - データベースに保存
  - 担当者情報を連携
- **検証:**
  - 企業名が一意であること
  - 電話番号が形式に合致すること
  - 郵便番号が7桁の数字であること

#### FR-003-02: 郵便番号自動検索
- **優先度:** 中
- **説明:** 郵便番号を入力すると住所が自動入力される
- **API:** zipcloud API連携
- **処理:**
  - 郵便番号（7桁）を入力
  - APIで住所を検索
  - 住所フィールドに自動入力

#### FR-003-03: パートナー編集
- **優先度:** 中
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** 既存パートナー企業の情報を編集できる

#### FR-003-04: パートナー削除
- **優先度:** 低
- **対象ロール:** ADMIN
- **説明:** 既存パートナー企業を削除できる
- **制約:**
  - プロジェクトが紐付いている場合は削除不可

---

### FR-004: プロジェクト管理

#### FR-004-01: プロジェクト作成
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** 新規プロジェクトを作成できる
- **入力:**
  - プロジェクト名（必須）
  - パートナー（必須）
  - 開始日（必須）
  - 終了日（任意）
  - ステータス（必須: 新規/進行中/完了）
  - 説明（任意）
  - 担当者（複数選択可）

#### FR-004-02: スプレッドシート機能
- **優先度:** 中
- **説明:** プロジェクトにExcel風のスプレッドシート機能を提供
- **機能:**
  - セルの編集
  - 行・列の追加・削除
  - セルの結合
  - 書式設定（太字、斜体、色）
  - 数式計算（SUM、AVERAGEなど）
  - 自動保存
- **データ形式:** JSON

#### FR-004-03: プロジェクト編集
- **優先度:** 中
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** 既存プロジェクトの情報を編集できる

#### FR-004-04: プロジェクト削除
- **優先度:** 低
- **対象ロール:** ADMIN
- **説明:** 既存プロジェクトを削除できる
- **制約:**
  - 手数料ルールが紐付いている場合は削除不可

---

### FR-005: 手数料ルール管理

#### FR-005-01: 手数料ルール作成
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING
- **説明:** 新規手数料ルールを作成できる
- **入力:**
  - ルール名（必須）
  - プロジェクト（必須）
  - 手数料タイプ（必須: 固定金額/割合）
  - 金額または割合（必須）
  - 説明（任意）
- **ステータス:** 下書き

#### FR-005-02: 手数料タイプ
1. **固定金額**
   - 数量に関係なく固定の金額を適用
   - 例: 100,000円

2. **割合**
   - 商品金額に対する割合を適用
   - 例: 10%

#### FR-005-03: 手数料ルール確定
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING
- **説明:** 下書きステータスのルールを確定できる
- **処理:**
  - ステータスを「確定」に変更
  - 確定日時を記録
- **制約:**
  - 確定後は編集・削除不可

#### FR-005-04: 手数料ルール削除
- **優先度:** 低
- **対象ロール:** ADMIN
- **説明:** 下書きステータスのルールを削除できる
- **制約:**
  - 確定済みのルールは削除不可

---

### FR-006: 請求書管理

#### FR-006-01: 請求書作成
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING
- **説明:** 新規請求書を作成できる
- **入力:**
  - パートナー（必須）
  - 請求日（必須）
  - 支払期限（必須）
  - 手数料ルール（必須）
  - 請求書アイテム（複数）
    - 商品名（必須）
    - 数量（必須）
    - 単価（必須）

#### FR-006-02: 自動計算機能
- **優先度:** 高
- **説明:** 請求書の金額を自動計算する
- **計算式:**
  - 小計 = Σ(数量 × 単価)
  - 手数料 = 手数料ルールに基づいて計算
  - 消費税 = (小計 + 手数料) × 10%
  - 合計金額 = 小計 + 手数料 + 消費税

#### FR-006-03: 請求書番号自動生成
- **優先度:** 中
- **説明:** 請求書番号を自動生成する
- **形式:** INV-YYYYMMDD-NNNN
- **例:** INV-20260210-0001

#### FR-006-04: PDF出力
- **優先度:** 高
- **説明:** 請求書をPDF形式でダウンロードできる
- **テンプレート:**
  - 複数のテンプレートを作成可能
  - デフォルトテンプレートを設定可能
  - カスタマイズ可能

#### FR-006-05: 請求書編集
- **優先度:** 中
- **対象ロール:** ADMIN、ACCOUNTING
- **説明:** 既存請求書の情報を編集できる

#### FR-006-06: 請求書削除
- **優先度:** 低
- **対象ロール:** ADMIN
- **説明:** 既存請求書を削除できる

---

### FR-007: コンテンツ管理

#### FR-007-01: フォルダー作成
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** 新規フォルダーを作成できる
- **入力:**
  - フォルダー名（必須）
  - 説明（任意）
  - 親フォルダー（任意、選択中のフォルダーがデフォルト）
- **階層:**
  - 無制限の階層構造をサポート
  - 親フォルダーがnullの場合はルートフォルダー

#### FR-007-02: ファイルアップロード
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** ファイルをアップロードできる
- **入力:**
  - ファイル（複数選択可）
  - アップロード先フォルダー（必須）
- **対応形式:**
  - ドキュメント: PDF、Word、Excel、PowerPoint
  - 画像: JPG、PNG、GIF
  - その他: ZIP、CSV、TXT
- **制限:**
  - 1ファイルあたり最大50MB

#### FR-007-03: ファイルダウンロード
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** ファイルをダウンロードできる
- **処理:**
  - ダウンロード回数をカウント

#### FR-007-04: お気に入り機能
- **優先度:** 中
- **対象ロール:** ADMIN、ACCOUNTING、REP
- **説明:** よく使うフォルダーをお気に入りに登録できる
- **制限:**
  - ユーザーごとに最大10個まで
- **特徴:**
  - 個人ごとに管理
  - 左サイドバーに表示
  - ワンクリックでアクセス

#### FR-007-05: パンくずリスト
- **優先度:** 中
- **説明:** フォルダー階層をパンくずリストで表示
- **表示ルール:**
  - 4階層以下: すべて表示
  - 5階層以上: ホーム + ... + 現在から2つ上まで
- **例:**
  - 浅い階層: ホーム › 製品カタログ › 2024年版
  - 深い階層: ホーム › ... › 東京 › 23区 › 港区

#### FR-007-06: サブフォルダー表示
- **優先度:** 中
- **説明:** フォルダーをクリックすると、1階層下のサブフォルダーとファイルを表示
- **表示内容:**
  - サブフォルダー（1階層下のみ）
  - ファイル

#### FR-007-07: フォルダー削除
- **優先度:** 低
- **対象ロール:** ADMIN
- **説明:** フォルダーを削除できる
- **制約:**
  - ファイルが存在する場合は削除不可
  - サブフォルダーがある場合は連鎖削除

#### FR-007-08: ファイル削除
- **優先度:** 低
- **対象ロール:** ADMIN
- **説明:** ファイルを削除できる

---

### FR-008: コンテンツ共有

#### FR-008-01: コンテンツ共有作成
- **優先度:** 高
- **対象ロール:** ADMIN、ACCOUNTING
- **説明:** ファイルをパートナー企業と共有できる
- **入力:**
  - ファイル（必須）
  - 共有先（必須: 特定パートナー/全パートナー）
  - 有効期限（任意）
  - ダウンロード制限回数（任意）
  - メッセージ（任意）

#### FR-008-02: 共有ステータス
- **説明:** 共有のステータスを自動更新
- **ステータス:**
  - **有効**: 共有が有効
  - **期限切れ**: 有効期限を過ぎた
  - **制限到達**: ダウンロード回数制限に到達
  - **無効化**: 手動で無効化された
- **自動更新:**
  - 有効期限を過ぎた場合 → 期限切れ
  - ダウンロード回数が制限に到達 → 制限到達

#### FR-008-03: 共有無効化
- **優先度:** 中
- **対象ロール:** ADMIN、ACCOUNTING
- **説明:** 有効な共有を手動で無効化できる

---

### FR-009: ダッシュボード

#### FR-009-01: 統計情報表示
- **優先度:** 中
- **対象ロール:** 全ロール
- **説明:** 主要な統計情報を表示
- **表示項目:**
  - パートナー数
  - プロジェクト数
  - 手数料ルール数
  - 請求書数

---

## 非機能要件

### NFR-001: パフォーマンス

#### NFR-001-01: レスポンスタイム
- **要件:** 通常操作で2秒以内にレスポンス
- **測定:** 画面遷移、データ取得、保存操作

#### NFR-001-02: 同時接続数
- **要件:** 同時100ユーザーまでサポート
- **負荷テスト:** 100ユーザー同時接続でレスポンスタイム3秒以内

#### NFR-001-03: ファイルアップロード
- **要件:** 50MBのファイルを30秒以内にアップロード

---

### NFR-002: セキュリティ

#### NFR-002-01: 認証
- **要件:** JWT トークンによる認証
- **有効期限:** 24時間
- **リフレッシュ:** 自動リフレッシュ機能

#### NFR-002-02: パスワード
- **要件:** BCryptでハッシュ化
- **強度:** 8文字以上

#### NFR-002-03: 通信
- **要件:** HTTPS通信
- **証明書:** SSL/TLS証明書

#### NFR-002-04: CORS
- **要件:** CORS設定で許可されたオリジンのみアクセス可能

---

### NFR-003: 可用性

#### NFR-003-01: 稼働率
- **要件:** 99.9%以上の稼働率
- **ダウンタイム:** 月間最大43分

#### NFR-003-02: バックアップ
- **要件:** 日次バックアップ
- **保持期間:** 30日間

---

### NFR-004: 保守性

#### NFR-004-01: ログ
- **要件:** エラーログ、アクセスログを記録
- **保持期間:** 90日間

#### NFR-004-02: 監視
- **要件:** サーバーのCPU、メモリ、ディスク使用率を監視
- **アラート:** 閾値超過時にアラート

---

### NFR-005: スケーラビリティ

#### NFR-005-01: データ量
- **要件:** 
  - パートナー数: 10,000社まで
  - プロジェクト数: 100,000件まで
  - 請求書数: 1,000,000件まで
  - ファイル数: 100,000ファイルまで

---

### NFR-006: ユーザビリティ

#### NFR-006-01: ブラウザ対応
- **要件:** Google Chrome、Firefox、Safari、Edge（最新版）

#### NFR-006-02: レスポンシブデザイン
- **要件:** PC、タブレット対応
- **画面解像度:** 1280×720 以上推奨

---

## システムアーキテクチャ

### アーキテクチャパターン
**3層アーキテクチャ**

```
┌─────────────────────┐
│  プレゼンテーション層  │ React
├─────────────────────┤
│   ビジネスロジック層   │ Spring Boot
├─────────────────────┤
│   データアクセス層     │ PostgreSQL
└─────────────────────┘
```

### 技術スタック

#### フロントエンド
- **フレームワーク:** React 19.2.3
- **状態管理:** React Hooks
- **HTTPクライアント:** Axios
- **ルーティング:** React Router
- **UI:** CSS（カスタム）

#### バックエンド
- **フレームワーク:** Spring Boot 3.5.9
- **言語:** Java 17
- **ORM:** Spring Data JPA
- **セキュリティ:** Spring Security + JWT
- **データベースマイグレーション:** Flyway

#### データベース
- **RDBMS:** PostgreSQL 16

#### 外部API
- **郵便番号検索:** zipcloud API

---

## データモデル

### エンティティ一覧

1. **User** - ユーザー
2. **Partner** - パートナー企業
3. **PartnerContact** - パートナー担当者
4. **Project** - プロジェクト
5. **CommissionRule** - 手数料ルール
6. **Invoice** - 請求書
7. **InvoiceItem** - 請求書アイテム
8. **InvoiceTemplate** - 請求書テンプレート
9. **ContentFolder** - コンテンツフォルダー
10. **ContentFile** - コンテンツファイル
11. **FavoriteFolder** - お気に入りフォルダー
12. **ContentShare** - コンテンツ共有

### 主要なリレーションシップ

```
User (1) → (0..*) Project : 担当
Partner (1) → (0..*) PartnerContact : 担当者
Partner (1) → (0..*) Project : プロジェクト
Project (1) → (0..*) CommissionRule : 手数料ルール
CommissionRule (1) → (0..*) Invoice : 請求書
Invoice (1) → (1..*) InvoiceItem : アイテム
ContentFolder (0..1) → (0..*) ContentFolder : 親子関係
ContentFolder (1) → (0..*) ContentFile : ファイル
User (1) → (0..*) FavoriteFolder : お気に入り
ContentFile (1) → (0..*) ContentShare : 共有
```

---

## セキュリティ要件

### 認証
- JWTトークンによる認証
- トークン有効期限: 24時間
- リフレッシュトークン: 自動更新

### 認可
- ロールベースアクセス制御（RBAC）
- エンドポイントごとに権限チェック

### パスワード
- BCryptでハッシュ化
- 最小8文字

### 通信
- HTTPS通信（本番環境）
- CORS設定

### データ保護
- 個人情報の暗号化
- データベースへのアクセス制限

---

## 制約事項

### 技術的制約
1. **ブラウザ:** 最新版のモダンブラウザのみサポート
2. **ファイルサイズ:** 1ファイルあたり最大50MB
3. **同時接続:** 最大100ユーザー

### ビジネス的制約
1. **お気に入り:** ユーザーごとに最大10個
2. **手数料ルール:** 確定後は編集・削除不可
3. **削除制限:** 関連データがある場合は削除不可

---

## 開発スケジュール

### フェーズ1: 基盤構築（完了）
- ユーザー管理
- 認証・認可
- ダッシュボード

### フェーズ2: コア機能（完了）
- パートナー管理
- プロジェクト管理
- 手数料ルール管理

### フェーズ3: 請求書機能（完了）
- 請求書作成
- PDF出力
- テンプレート管理

### フェーズ4: コンテンツ管理（完了）
- フォルダー・ファイル管理
- お気に入り機能
- パンくずリスト
- コンテンツ共有

### フェーズ5: テスト・デプロイ（次フェーズ）
- 総合テスト
- 本番環境デプロイ

---

## リスクと対策

### リスク1: パフォーマンス低下
- **リスク:** データ量増加によるパフォーマンス低下
- **対策:** 
  - インデックスの最適化
  - ページネーション実装
  - キャッシュの活用

### リスク2: セキュリティ脆弱性
- **リスク:** 認証・認可の脆弱性
- **対策:**
  - セキュリティテスト実施
  - 定期的な脆弱性診断
  - ライブラリの定期更新

### リスク3: データ損失
- **リスク:** システム障害によるデータ損失
- **対策:**
  - 日次バックアップ
  - トランザクション管理
  - データベースレプリケーション（将来）

---

**ドキュメント終わり**