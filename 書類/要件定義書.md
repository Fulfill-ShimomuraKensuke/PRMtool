# PRM Tool - 要件定義書

**プロジェクト名**: PRM Tool (Partner Relationship Management Tool)  
**バージョン**: 1.0.0  
**作成日**: 2026-01-16  
**最終更新**: 2026-01-21

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [システム要件](#2-システム要件)
3. [機能要件](#3-機能要件)
4. [非機能要件](#4-非機能要件)
5. [データベース設計](#5-データベース設計)
6. [API仕様](#6-api仕様)
7. [画面設計](#7-画面設計)
8. [セキュリティ要件](#8-セキュリティ要件)
9. [運用要件](#9-運用要件)
10. [制約事項](#10-制約事項)

---

## 1. プロジェクト概要

### 1.1 目的

パートナー企業との関係管理、案件管理、手数料管理、請求管理を統合的に行い、業務効率を向上させるためのWebアプリケーションを開発する。

### 1.2 背景

- パートナー企業の情報が分散している
- 案件の進捗管理が非効率
- 手数料の承認プロセスが煩雑
- 請求書作成に時間がかかる
- ユーザー権限管理が不十分

### 1.3 スコープ

**含まれるもの**:
- ユーザー管理機能（認証・認可）
- パートナー管理機能
- 案件管理機能
- 手数料管理機能
- 請求管理機能
- ダッシュボード機能
- CSV入出力機能

**含まれないもの**:
- メール送信機能
- 自動レポート生成機能
- モバイルアプリ
- 外部システム連携
- ファイルアップロード機能

### 1.4 想定ユーザー

- **システム管理者（SYSTEM）**: 初回セットアップのみ
- **管理者（ADMIN）**: 全機能の利用・管理
- **担当者（REP）**: 案件・手数料・請求の管理

---

## 2. システム要件

### 2.1 技術スタック

#### Backend
- **言語**: Java 17+
- **フレームワーク**: Spring Boot 3.5.9
- **ORM**: Hibernate (JPA)
- **セキュリティ**: Spring Security
- **認証**: JWT
- **ビルドツール**: Maven 3.8+
- **CSV処理**: Apache Commons CSV 1.10.0

#### Frontend
- **言語**: JavaScript (ES6+)
- **ライブラリ**: React 19.2.3
- **ルーティング**: React Router 6.x
- **HTTP Client**: Axios

#### データベース
- **RDBMS**: PostgreSQL 16+
- **コンテナ**: Docker 20.x+

---

## 3. 機能要件

（機能要件の詳細は、GitHub版README.mdおよび実装を参照）

### 3.1 認証機能
- ログイン/ログアウト
- JWT トークン発行
- 初回管理者自動作成

### 3.2 アカウント管理
- CRUD操作
- 検索・フィルター
- ロール管理（SYSTEM, ADMIN, REP）

### 3.3 パートナー管理
- CRUD操作
- 複数連絡先管理
- CSV入出力

### 3.4 案件管理
- CRUD操作
- 担当者アサイン
- ステータス管理

### 3.5 手数料管理
- CRUD操作
- ステータスワークフロー
- CSV入出力

### 3.6 請求管理
- CRUD操作
- 明細管理
- 消費税自動計算

### 3.7 ダッシュボード
- タブ形式統計表示
- パートナー別ダッシュボード

---

## 4. 非機能要件

### 4.1 パフォーマンス
- 応答時間: 通常操作は2秒以内
- 同時接続数: 100ユーザーまで対応

### 4.2 可用性
- 稼働率: 99%以上（本番環境）

### 4.3 拡張性
- ユーザー数: 1000ユーザーまで拡張可能
- データ量: 10万レコードまで対応

---

## 5. データベース設計

### 5.1 主要エンティティ

- **users**: ユーザー情報
- **partners**: パートナー企業情報
- **projects**: 案件情報
- **project_assignments**: 案件担当者
- **commissions**: 手数料情報
- **invoices**: 請求情報
- **invoice_items**: 請求明細

詳細なテーブル定義は、プロジェクトのentityクラスを参照。

---

## 6. API仕様

### 6.1 認証API
- `POST /api/auth/login`: ログイン

### 6.2 アカウント管理API
- `GET /api/users`: ユーザー一覧
- `POST /api/users`: ユーザー作成
- `PUT /api/users/{id}`: ユーザー更新
- `DELETE /api/users/{id}`: ユーザー削除

### 6.3 パートナー管理API
- `GET /api/partners`: パートナー一覧
- `POST /api/partners`: パートナー作成
- `PUT /api/partners/{id}`: パートナー更新
- `DELETE /api/partners/{id}`: パートナー削除
- `POST /api/partners/import-csv`: CSV インポート
- `GET /api/partners/export-csv`: CSV エクスポート

### 6.4 案件管理API
- `GET /api/projects`: 案件一覧
- `POST /api/projects`: 案件作成
- `PUT /api/projects/{id}`: 案件更新
- `DELETE /api/projects/{id}`: 案件削除
- `POST /api/projects/import-csv`: CSV インポート
- `GET /api/projects/export-csv`: CSV エクスポート

### 6.5 手数料管理API
- `GET /api/commissions`: 手数料一覧
- `POST /api/commissions`: 手数料作成
- `PUT /api/commissions/{id}`: 手数料更新
- `DELETE /api/commissions/{id}`: 手数料削除
- `POST /api/commissions/import-csv`: CSV インポート
- `GET /api/commissions/export-csv`: CSV エクスポート

### 6.6 請求管理API
- `GET /api/invoices`: 請求一覧
- `POST /api/invoices`: 請求作成
- `PUT /api/invoices/{id}`: 請求更新
- `DELETE /api/invoices/{id}`: 請求削除
- `POST /api/invoices/import-csv`: CSV インポート
- `GET /api/invoices/export-csv`: CSV エクスポート

---

## 7. 画面設計

### 7.1 画面一覧

| 画面ID | 画面名 | パス | アクセス権限 |
|-------|-------|------|------------|
| SC-001 | ログイン | `/login` | 全員 |
| SC-002 | ダッシュボード | `/dashboard` | ADMIN, REP |
| SC-003 | アカウント管理 | `/accounts` | ADMIN, SYSTEM |
| SC-004 | パートナー管理 | `/partners` | ADMIN, REP |
| SC-005 | 案件管理 | `/projects` | ADMIN, REP |
| SC-006 | 手数料管理 | `/commissions` | ADMIN, REP |
| SC-007 | 請求管理 | `/invoices` | ADMIN, REP |
| SC-008 | パートナーダッシュボード | `/partners/:id/dashboard` | ADMIN, REP |

---

## 8. セキュリティ要件

### 8.1 認証・認可
- JWT トークンベース認証
- トークン有効期限: 24時間
- ロールベースアクセス制御（RBAC）

### 8.2 パスワードポリシー
- 最小長: 8文字
- 推奨: 英大文字・小文字・数字・記号を含む
- ハッシュ化: BCrypt（コスト: 10）

### 8.3 データ保護
- データベース接続情報は環境変数で管理
- 本番環境では必ずHTTPSを使用
- SQLインジェクション対策: PreparedStatement使用

---

## 9. 運用要件

### 9.1 バックアップ
- 頻度: 日次（本番環境）
- 保持期間: 30日
- 対象: データベース全体

### 9.2 ログ
- 開発環境: DEBUG
- 本番環境: INFO

### 9.3 監視
- ヘルスチェック: `/actuator/health`
- データベース接続チェック

---

## 10. 制約事項

### 10.1 技術的制約
- PostgreSQL 16以上必須
- Java 17以上必須

### 10.2 機能的制約
- SYSTEMロールは初回セットアップ専用
- 案件に関連付けられたパートナーは削除不可
- 同時編集は未対応

---

**文書履歴**

| バージョン | 日付 | 変更内容 |
|----------|------|---------|
| 1.0.0 | 2026-01-16 | 初版作成 |
| 1.0.1 | 2026-01-21 | 手数料・請求機能追加 |
