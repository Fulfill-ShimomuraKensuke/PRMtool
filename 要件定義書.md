# PRMツール 要件定義書

**最終更新日**: 2025年12月18日
**本番環境URL**: https://prmtool-1.onrender.com

---

## 1. プロジェクト概要
- **名称**: シンプルPRMツール
- **目的**: パートナー企業や案件の管理を行うポートフォリオ向けWebアプリケーション開発
- **対象ユーザー**: 管理者、担当者
- **開発環境・技術スタック**:
  - 言語: Java 17
  - バックエンドフレームワーク: Spring Boot 3.5.9
  - 認証: Spring Security 6.x + JWT (JJWT 0.12.3)
  - DB: PostgreSQL 17
  - ORM: Spring Data JPA + Hibernate 6.6
  - フロントエンド: React 18
  - HTTPクライアント: Axios
  - ルーティング: React Router DOM 6.x
  - コンテナ: Docker & Docker Compose
  - 本番環境: Render.com

---

## 2. 用語定義

| 用語   | 説明                          |
|--------|------------------------------|
| ユーザー | システムを利用する人物(管理者／担当者) |
| 管理者 | システム管理、パートナーや案件の管理権限(編集&削除権限)を持つユーザー |
| 担当者 | 管理者の管轄下に属すユーザー |
| パートナー企業 | 取引のあるパートナー企業 |
| 案件 | パートナーとの取引やプロジェクト |
| JWT | JSON Web Token(認証トークン) |
| CRUD | Create/Read/Update/Delete(基本操作) |

---
## 3. 実装済み機能一覧

| 機能カテゴリ   | 機能             | 内容概要                                | 対象ユーザー   | 実装状況 |
|---------------|------------------|----------------------------------------|---------------|---------|
| 認証・認可     |ユーザー登録       | メール・パスワードで新規登録、ロール選択   | 管理者,担当者  | ✅     |
|               | ログイン          | メール・パスワードでログインしJWT取得      | 管理者,担当者 | ✅     |
|               | ログアウト        | JWTトークンの破棄、ローカルストレージクリア | 管理者,担当者 | ✅     |
|               | 自動ログアウト     | トークン期限切れ時の自動ログアウト         | 管理者,担当者 | ✅     |
| パートナー管理 | パートナー企業登録  | 企業名、住所、電話番号などの登録          | 管理者        | ✅     |
|               | パートナー編集     | 既存パートナー情報の更新                 | 管理者        | ✅      |
|               | パートナー削除     | パートナー企業の削除(確認ダイアログ付き) | 管理者        | ✅     |
|               | パートナー一覧閲覧 | 登録済パートナー企業の一覧表示(カード形式)| 管理者　　　　| ✅     |
| 案件管理       | 案件登録         | 案件名、状況、紐づくパートナー登録          | 管理者,担当者 | ✅     |
|               | 案件編集          | 既存案件情報の更新                        | 管理者,担当者 | ✅     |
|               | 案件削除          | 案件の削除(管理者のみ)                   | 管理者       | ✅     |
|               | 案件一覧閲覧      | 全案件の一覧表示(テーブル形式)            | 管理者,担当者 | ✅     |
| ダッシュボード | 案件サマリー表示    | 全案件を状態別(新規/進行中/完了)で表示   | 管理者,担当者 | ✅     |
|               | 最近の案件表示     | 最新10件の案件をカード形式で表示           | 管理者,担当者 | ✅     |
| UI/UX         | ナビゲーションバー | ロールに応じたメニュー表示、ログアウト機能   | 管理者,担当者 | ✅    |
|               | プライベートルート | 未認証時の自動リダイレクト                 | 管理者,担当者 | ✅     |
|               | モーダルダイアログ | 登録・編集フォームのモーダル表示           | 管理者,担当者 | ✅     |
|               | レスポンシブデザイン | モバイル対応のUI                       | 管理者,担当者 | ✅      |
| デプロイ       | 本番環境          | Render.comへのデプロイ完了               | -            | ✅      |

---

## 4. 非機能要件

| 項目         | 内容                                             | 実装状況 |
|------------|------------------------------------------------|------|
| 性能         | 同時アクセス10ユーザー程度を想定                         | ✅ |
| セキュリティ    | - JWT認証によるAPIアクセス制御<br>- パスワードBCryptハッシュ化<br>- CORS設定<br>- ロールベースアクセス制御 | ✅ |
| 可用性        | 開発環境での動作を保証、本番環境(Render.com)で稼働中              | ✅ |
| 拡張性        | REST API設計による独立開発可能                                    | ✅ |
| 保守性        | レイヤードアーキテクチャによる保守性確保                                  | ✅ |
| データ永続性    | PostgreSQL 17による永続化                            | ✅ |
| 環境切り替え    | プロファイル設定(dev/prod/test)                       | ✅ |

---

## 5. 画面一覧と実装詳細

| 画面名      | 概要                                        | 主な機能                                  | 実装状況 |
|------------|---------------------------------------------|-----------------------------------------------|-----|
| ログイン画面 | ユーザーがメール・パスワードでログインする画面 | ログイン処理、エラーメッセージ表示、新規登録リンク | ✅ |
| ユーザー登録画面 | 新規ユーザー登録                         | メール・パスワード入力、ロール選択、パスワード確認 | ✅ |
| ダッシュボード  | ログイン後のトップ画面、案件サマリー表示    | 状態別案件数表示、最近の案件一覧                 | ✅ |
| パートナー管理画面|パートナー企業の登録･編集･一覧表示(管理者のみ)|カード形式一覧、モーダルフォーム、編集･削除ボタン| ✅ |
| 案件管理画面    | 案件登録・編集・一覧表示      | テーブル形式一覧、モーダルフォーム、ステータスバッジ | ✅ |

---

## 6. データ設計(実装テーブル)

### ユーザーテーブル(users)

| カラム名       | データ型      | Key         | 備考      | 実装 |
|------------|-----------|------------|------------------|------|
| id         | UUID      | Primary Key | 自動生成            | ✅ |
| email      | VARCHAR(255)   | UNQ, NOT NULL | ログインIDとして使用 | ✅ |
| password   | VARCHAR(255)   | NOT NULL   | BCryptハッシュ化       | ✅ |
| role       | VARCHAR(50)   | NOT NULL   | ADMIN / REP  | ✅ |
| created_at | TIMESTAMP | NOT NULL   | 作成日時自動設定      | ✅ |
| updated_at | TIMESTAMP | NOT NULL   | 更新日時自動更新      | ✅ |

### パートナーテーブル(partners)

| カラム名    | データ型   | Key     | 備考     | 実装 |
|------------|-----------|---------|-----------|-----|
| id         | UUID      | Primary Key | 自動生成     | ✅ |
| name       | VARCHAR(255) | NOT NULL | 企業名 | ✅ |
| address    | VARCHAR(500) |         | 住所    | ✅ |
| phone      | VARCHAR(50)  |         | 電話番号 | ✅ |
| created_at | TIMESTAMP | NOT NULL | 作成日時    | ✅ |
| updated_at | TIMESTAMP | NOT NULL | 更新日時    | ✅ |

### 案件テーブル(projects)

| カラム名       | データ型              | Key      | 備考        | 実装 |
|------------|-----------|-------------|------------------------|-----|
| id         | UUID      | Primary Key | 自動生成                | ✅ |
| name       | VARCHAR(255)| NOT NULL  | 案件名                | ✅ |
| status     | VARCHAR(50) | NOT NULL  | NEW, IN_PROGRESS, DONE | ✅ |
| partner_id | UUID      | Foreign Key | partnersテーブルのid参照     | ✅ |
| owner_id   | UUID      | Foreign Key | usersテーブルのid参照(担当者) | ✅ |
| created_at | TIMESTAMP | NOT NULL | 作成日時                    | ✅ |
| updated_at | TIMESTAMP | NOT NULL | 更新日時                    | ✅ |

**エンティティ関連:**
```
User (1) ----< (*) Project
Partner (1) ----< (*) Project
```

---

## 7. REST API仕様(実装済み)

### 認証API

| メソッド | URL                 | 説明                | 認証  | 実装 |
|--------|---------------------|----------------------|-----|-----|
| POST   | /api/auth/register   | ユーザー登録         | ×   | ✅ |
| POST   | /api/auth/login      | ログイン(JWT発行)  | ×   | ✅ |

### パートナー管理API(管理者のみ)

| メソッド | URL                 | 説明                | 認証  | 実装 |
|--------|---------------------|----------------------|-----|-----|
| GET    | /api/partners        | パートナー一覧取得    | JWT | ✅ |
| GET    | /api/partners/{id}   | パートナー詳細取得    | JWT | ✅ |
| POST   | /api/partners        | 新規パートナー登録    | JWT | ✅ |
| PUT    | /api/partners/{id}   | パートナー更新        | JWT | ✅ |
| DELETE | /api/partners/{id}   | パートナー削除        | JWT | ✅ |

### 案件管理API

| メソッド | URL                 | 説明                   | 認証  | 実装 |
|--------|---------------------|----------------------|-----|-----|
| GET    | /api/projects        | 案件一覧取得             | JWT | ✅ |
| GET    | /api/projects/{id}   | 案件詳細取得             | JWT | ✅ |
| POST   | /api/projects        | 案件登録                 | JWT | ✅ |
| PUT    | /api/projects/{id}   | 案件更新                 | JWT | ✅ |
| DELETE | /api/projects/{id}   | 案件削除(管理者のみ)     | JWT | ✅ |

---

## 8. セキュリティ実装詳細

| 項目               | 実装内容                                             | 実装状況 |
|------------------|-------------------------------------------------------|------|
| パスワードハッシュ化      | BCryptPasswordEncoder使用                       | ✅ |
| JWT認証            | JJWT 0.12.3使用、HS512アルゴリズム                     | ✅ |
| トークン有効期限        | 24時間(環境変数でカスタマイズ可能)                 | ✅ |
| 自動ログアウト         | 401エラーor403エラー時にフロントエンドで自動ログアウト | ✅ |
| CORS設定           | Spring SecurityでCORS許可設定                          | ✅ |
| ロールベースアクセス制御    | @PreAuthorize使用                              | ✅ |
| SQLインジェクション対策  | JPAパラメータバインディング                        | ✅ |
| XSS対策            | Spring Securityデフォルト設定                         | ✅ |

---

## 9. 技術選定理由

| 技術                 | 選定理由                                              |
|--------------------|--------------------------------------------------------|
| Spring Boot 3.5.8   | 最新の安定版、開発効率の向上、豊富なエコシステム          |
| Spring Security 6.x | 成熟した認証・認可フレームワーク、JWT統合が容易           |
| PostgreSQL 17       | 信頼性の高いRDBMS、UUID型サポート、本番環境でも使用可能   |
| React 18           | モダンなUI構築、豊富なライブラリ、コンポーネント指向        |
| Axios              | シンプルなHTTPクライアント、インターセプター機能           |
| React Router DOM   | SPAのルーティング、プログラマティックナビゲーション        |
| Docker Compose     | 開発環境の統一、PostgreSQL簡易セットアップ                |
| HikariCP           | 高性能な接続プール、Spring Boot標準                      |
| Render.com         | 無料でPostgreSQL + Web Service + Static Site提供、CI/CD自動化 |

---

## 10. 開発実績

### 実際の開発期間

| フェーズ      | 内容                        | 状況 |
|------------|-------------------------------|-----|
| 1          | 要件定義・画面設計              | ✅ |
| 2          | バックエンド基盤構築・認証実装   | ✅ |
| 3          | パートナー/案件CRUD機能実装     | ✅ |
| 4          | フロントエンド(React)画面作成 | ✅ |
| 5          | 統合テスト・バグ修正           | ✅ |
| 6          | 本番環境デプロイ(Render.com) | ✅ |
| 7          | ドキュメント整備               | ✅ |

---

## 11. 本番環境情報

### デプロイ先
- **プラットフォーム**: Render.com
- **フロントエンド**: https://prmtool-1.onrender.com
- **バックエンドAPI**: https://prmtool.onrender.com
- **データベース**: PostgreSQL 17(Render Managed Database)

### 環境設定
**バックエンド環境変数:**
```
SPRING_PROFILES_ACTIVE=prod
DB_URL=jdbc:postgresql://dpg-xxx.onrender.com:5432/prmdb_1id2
DB_USERNAME=prmuser
DB_PASSWORD=<自動生成>
JWT_SECRET=<本番用秘密鍵>
```

**フロントエンド環境変数:**
```
REACT_APP_API_BASE_URL=https://prmtool.onrender.com
```

---

## 12. 既知の制約・制限事項

| 項目               | 内容                                        |
|------------------|----------------------------------------------|
| 同時接続数           | 開発環境想定のため、10ユーザー程度を想定     |
| メール送信           | メール認証・通知機能は未実装                |
| ファイルアップロード  | 現状未対応                                |
| パスワードリセット    | 現状未対応                                |
| 監査ログ            | 現状未対応                                 |
| 多言語対応           | 日本語のみ                                |
| アクセシビリティ対応  | 基本的なHTML構造のみ対応                   |
| Renderの制約        | 無料プランのため、15分間アクセスがないとスリープ状態になる|

---

## 13. テスト実施状況

| テスト種別     | 実施内容                | 状況 |
|-----------|---------------------|-----|
| 単体テスト     | バックエンド主要機能          | ✅ 実施済 |
| 統合テスト     | API疎通確認             | ✅ 実施済 |
| E2Eテスト    | フロントエンド主要画面遷移      | ✅ 実施済 |
| セキュリティテスト | JWT認証、権限制御の動作確認    | ✅ 実施済 |
| 本番環境テスト    | Render.comでの動作確認     | ✅ 実施済 |

---

## 14. デプロイ情報

### 開発環境
- **OS**: Windows 11 / macOS / Linux
- **ポート**:
  - バックエンド: 8080
  - フロントエンド: 3000
  - PostgreSQL: 5432

### 本番環境
- **サーバー**: Render.com
- **データベース**: Render PostgreSQL Managed Database
- **フロントエンド**: Render Static Site
- **バックエンド**: Render Web Service
- **CI/CD**: GitHub連携による自動デプロイ

---

## 15. 参考資料

- [Spring Boot公式ドキュメント](https://spring.io/projects/spring-boot)
- [Spring Security Reference](https://docs.spring.io/spring-security/reference/)
- [React公式ドキュメント](https://react.dev/)
- [PostgreSQL公式ドキュメント](https://www.postgresql.org/docs/)
- [JWT.io](https://jwt.io/)
- [Docker公式ドキュメント](https://docs.docker.com/)
- [Render.com Documentation](https://render.com/docs)

---

## 16. プロジェクト管理

### リポジトリ
- **GitHub**: https://github.com/Simomura0716/PRMtool

### ドキュメント
- ✅ README.md
- ✅ 要件定義書.md

### バージョン管理
- **現在のバージョン**: v1.0.0

---

以上